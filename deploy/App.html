<!DOCTYPE html>
<html>
<head>
    <title>investmentcategory</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",launch:function(){this.down("rallychart")&&this.down("rallychart").destroy(),this.down("label")&&this.down("label").destroy(),this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Calculating... Please wait."}),this._myMask.show();var filters=[];filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"PercentDoneByStoryCount",operator:">",value:0})),filters.push(Ext.create("Rally.data.wsapi.Filter",{property:"PercentDoneByStoryCount",operator:"<",value:1}));var dataScope=this.getContext().getDataContext(),store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature ",fetch:["ObjectID","Name","LeafStoryPlanEstimateTotal","InvestmentCategory","PercentDoneByStoryCount"],context:dataScope,pageSize:2e3,limit:2e3},this),investmentCategories={};store.addFilter(filters,!1),store.loadPage(1,{scope:this,callback:function(records,operation){if(operation.wasSuccessful())if(records.length>0){var totalPoints=0;_.each(records,function(record){record.raw.InvestmentCategory in investmentCategories||(investmentCategories[record.raw.InvestmentCategory]=0),investmentCategories[record.raw.InvestmentCategory]+=record.raw.LeafStoryPlanEstimateTotal,totalPoints+=record.raw.LeafStoryPlanEstimateTotal},this);var series=[];series.push({}),series[0].name="Investment Categories",series[0].colorByPoint=!0,series[0].data=[],_.each(_.keys(investmentCategories),function(investmentCategory){series[0].data.push({name:investmentCategory,y:investmentCategories[investmentCategory]})},this),this.makeChart(series)}else 0===records.length&&0===this.features.length&&this.showNoDataBox()}})},makeChart:function(series){var chart=this.add({xtype:"rallychart",chartConfig:{chart:{type:"pie"},title:{text:"Investment Category Spend"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}}},chartData:{series:series}});chart.setChartColors(["#005EB8","#FF8200","#FAD200","#7CAFD7","#F6A900","#FFDD82"]),this._myMask.hide()},showNoDataBox:function(){this._myMask.hide(),this.add({xtype:"label",text:"There is no data. Check if there are iterations in scope and work items with PlanEstimate assigned for iterations"})}});

            Rally.launchApp('CustomApp', {
                name:"investmentcategory",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
